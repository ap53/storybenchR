<!-- wp:paragraph -->
<p><em>TLDR: This tutorial was prompted by the recent changes to the <code>tidyr</code> package (see the tweet from Hadley Wickham below). Two functions for reshaping columns and rows (<code>gather()</code> and <code>spread()</code>) were replaced with <code>tidyr::pivot_longer()</code> and <code>tidyr::pivot_wider()</code> functions.</em></p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><p>Thanks to all 2649 (!!!) people who completed my survey about table shapes! I've done analysed the data at <a href="https://t.co/hyu1o91xRm">https://t.co/hyu1o91xRm</a> and the new functions will be called pivot_longer() and pivot_wider() <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a>— Hadley Wickham (@hadleywickham) <a href="https://twitter.com/hadleywickham/status/1109816130774986753?ref_src=twsrc%5Etfw">March 24, 2019</a></p></blockquote>
<!-- /wp:quote -->

<!-- wp:heading -->
<h2>Load packages</h2>
<!-- /wp:heading -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted"># this will require the newest version of tidyr from github <br># devtools::install_github("tidyverse/tidyr") <br>library(tidyverse) <br>library(here)</pre>
<!-- /wp:preformatted -->

<!-- wp:heading -->
<h2>Objectives</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>This tutorial will cover three concepts about working with data in the <code>tidyverse</code>: </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>1) tidy data,  <br>
  2) grouping, and  <br>
  3) the new pivoting verbs in <code>tidyr</code></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>A solid understanding of these topics makes it easier to manipulate and re-structure your data for visualizations and modeling in the <code>tidyverse</code>.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>I'll be using examples of spreadsheets that were designed for data entry, not necessarily statistical modeling or graphics. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>My goal is that by showing the reasoning behind the data entry process, you'll walk away with a better understanding (and hopefully a little less frustration) for why data are collected in so many different ways. </p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":1} -->
<h1>Part one: Tidy data</h1>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><a href="https://www.jstatsoft.org/article/view/v059i10">Tidy data</a> is… <em>"a standardized way to link the structure of a dataset (its physical layout) with its semantics (its meaning)"</em></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If you’ve worked with SQL and relational databases, you’ll recognize most of these concepts. Hadley Wickham distilled a lot of the technical jargon from <a href="https://en.wikipedia.org/wiki/Third_normal_form">Edgar F. Codd’s 'normal form'</a> and applied it to statistical terms. More importantly, he translated these essential principles into concepts and terms a broader audience can grasp and use for data manipulation. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Get the data and code to follow along <a href="https://github.com/mjfrigaard/storybenchR/tree/master/02.1-tidyr-tidyverse">here</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted"># load data from Github <br>base::load(file = "data/tidyr-data.RData")</pre>
<!-- /wp:preformatted -->

<!-- wp:heading -->
<h2>The tidy data principles</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Tidy data refers to 'rectangular' data. These are the data we typically see in spreadsheet software like Googlesheets, Microsoft Excel, or in a relational database like MySQL, PostgreSQL, or Microsoft Access, The three principles for tidy data are:</p>
<!-- /wp:paragraph -->

<!-- wp:list {"ordered":true} -->
<ol><li>Variables make up the columns  </li><li>Observations (or cases) go in the rows  </li><li>Values are in cells  </li></ol>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>Put them together, and these three statements make up the contents in a <a href="https://tibble.tidyverse.org/">data frame or tibble</a>. Data frame's can contain any number of variables, which are used to store various measurements associated with each observation. While these principles might seem obvious at first, many of the data arrangements we encounter in real life don't adhere to this guidance.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>Indexed vs. Cartesian</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>I prefer to refer to tidy data as "indexed", and wide data as "Cartesian" (this terminology is from the <a href="https://amzn.to/2UlyNNp">ggplot2</a> text). These terms help me understand what is happening when the data get transformed. Two examples are below:</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4>Indexed data</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>In the <code>Indexed</code> data frame, the <code>group</code> and <code>number</code> variables are used to keep track of each unique value of <code>measure</code>.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">Indexed</pre>
<!-- /wp:preformatted -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>group</th><th>number</th><th>measure</th></tr></thead><tbody><tr><td>A</td><td>ID001</td><td>1098</td></tr><tr><td>C</td><td>ID001</td><td>3049</td></tr><tr><td>D</td><td>ID003</td><td>2394</td></tr><tr><td>B</td><td>ID004</td><td>9301</td></tr><tr><td>C</td><td>ID006</td><td>4092</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>The same data are represented in the <code>Cartesian</code> data frame, but in this<br> table the <code>measure</code> values are at the intersection of <code>group</code> and each<br> <code>number</code>.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">Cartesian</pre>
<!-- /wp:preformatted -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>group</th><th>ID001</th><th>ID003</th><th>ID004</th><th>ID006</th></tr></thead><tbody><tr><td>A</td><td>1098</td><td>NA</td><td>NA</td><td>NA</td></tr><tr><td>B</td><td>NA</td><td>NA</td><td>9301</td><td>NA</td></tr><tr><td>C</td><td>3049</td><td>NA</td><td>NA</td><td>4092</td></tr><tr><td>D</td><td>NA</td><td>2394</td><td>NA</td><td>NA</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>As you can see, the <code>Cartesian</code> orientation uses up more columns (and<br>fills in the gaps with missing (<code>NA</code>) values).</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><img src="https://github.com/mjfrigaard/storybenchR/blob/master/02.1-tidyr-tidyverse/images/indexed-carteisan.png?raw=true" alt=""/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":1} -->
<h1>Part two: Grouping</h1>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Grouping produces summary data tables using functions from the <code>dplyr</code> package. Similar to <code>GROUP BY</code> in SQL, <code>dplyr::group_by()</code> silently groups a data frame (which means we don't see any changes) and then applies aggregate functions using <code>dplyr::summarize()</code>. Examples of these are <code>mean()</code>, <code>median()</code>, <code>sum()</code>, <code>n()</code>, <code>sd()</code>, etc.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Take the data frame below, <code>DataTibble</code>, which has 5 variables: </p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><li><code>group_var</code> - a categorical group </li><li><code>year</code> - the calendar year the measurements were collected </li><li><code>x_measurement</code> and <code>y_measurement</code> - these are randomly generated numbers</li><li><code>ordinal_x_var</code> - this is an ordinal variable corresponding to the values in <code>x_measurement</code> (greater than or equal to 75 is <code>"high"</code> or <code>3</code>, greater than or equal to <code>50</code> and less than <code>75</code> is <code>"med"</code>, and less than <code>50</code> is <code>"low"</code>).</li></ul>
<!-- /wp:list -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">DataTibble</pre>
<!-- /wp:preformatted -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>group_var</th><th>year</th><th>x_measurement</th><th>y_messurement</th><th>ordinal_y_var</th></tr></thead><tbody><tr><td>A</td><td>2018</td><td>11.81</td><td>532.37</td><td>med</td></tr><tr><td>A</td><td>2017</td><td>28.46</td><td>116.04</td><td>low</td></tr><tr><td>A</td><td>2016</td><td>49.15</td><td>304.21</td><td>low</td></tr><tr><td>B</td><td>2018</td><td>87.56</td><td>719.38</td><td>med</td></tr><tr><td>B</td><td>2017</td><td>11.33</td><td>984.38</td><td>high</td></tr><tr><td>C</td><td>2018</td><td>15.87</td><td>959.41</td><td>high</td></tr><tr><td>C</td><td>2017</td><td>63.76</td><td>962.27</td><td>high</td></tr><tr><td>C</td><td>2016</td><td>96.03</td><td>744.52</td><td>med</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>If I apply <code>dplyr::group_by()</code> to the <code>group_var</code> in <code>DataTibble</code>, I will see no visible result.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">DataTibble %>% <br>    dplyr::group_by(group_var)</pre>
<!-- /wp:preformatted -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>group_var</th><th>year</th><th>x_measurement</th><th>y_messurement</th><th>ordinal_y_var</th></tr></thead><tbody><tr><td>A</td><td>2018</td><td>11.81</td><td>532.37</td><td>med</td></tr><tr><td>A</td><td>2017</td><td>28.46</td><td>116.04</td><td>low</td></tr><tr><td>A</td><td>2016</td><td>49.15</td><td>304.21</td><td>low</td></tr><tr><td>B</td><td>2018</td><td>87.56</td><td>719.38</td><td>med</td></tr><tr><td>B</td><td>2017</td><td>11.33</td><td>984.38</td><td>high</td></tr><tr><td>C</td><td>2018</td><td>15.87</td><td>959.41</td><td>high</td></tr><tr><td>C</td><td>2017</td><td>63.76</td><td>962.27</td><td>high</td></tr><tr><td>C</td><td>2016</td><td>96.03</td><td>744.52</td><td>med</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>But when I combine <code>dplyr::group_by()</code> with <code>dplyr::summarize()</code>, I can collapse <code>DataTibble</code> into a smaller table by supplying an aggregate function to <code>summarize()</code>. Below I use <code>summarize()</code> to get the mean of <code>x_measurement</code> and <code>y_messurement</code> and <code>n()</code> to get the total number in each group.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">DataTibble %>% <br>  dplyr::group_by(group_var) %>% <br>  dplyr::summarize(x_mean = mean(x_measurement),     <br>                   y_mean = mean(y_messurement),     <br>                   no = n())</pre>
<!-- /wp:preformatted -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>group_var</th><th>x_mean</th><th>y_mean</th><th>no</th></tr></thead><tbody><tr><td>A</td><td>29.80667</td><td>317.5400</td><td>3</td></tr><tr><td>B</td><td>49.44500</td><td>851.8800</td><td>2</td></tr><tr><td>C</td><td>58.55333</td><td>888.7333</td><td>3</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>Grouping can also work with categorical/factor variables. The code below uses <code>dplyr::count()</code> to summarize the number of <code>ordinal_y_var</code> levels per category of <code>group_var</code></p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">DataTibble %>% <br>      dplyr::count(group_var, ordinal_y_var)</pre>
<!-- /wp:preformatted -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>group_var</th><th>ordinal_y_var</th><th>n</th></tr></thead><tbody><tr><td>A</td><td>med</td><td>1</td></tr><tr><td>A</td><td>low</td><td>2</td></tr><tr><td>B</td><td>high</td><td>1</td></tr><tr><td>B</td><td>med</td><td>1</td></tr><tr><td>C</td><td>high</td><td>2</td></tr><tr><td>C</td><td>med</td><td>1</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>This table isn't as easy to read, because all of the information is oriented vertically. I can move the values of <code>group_var</code> into individual columns to make it easier on the eyes using <code>tidyr::spread()</code></p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">DataTibble %>% <br>    dplyr::count(group_var,ordinal_y_var) %>% <br>    tidyr::spread(key = group_var,value = n)</pre>
<!-- /wp:preformatted -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted"># this is what is would look like in the console!<br># A tibble: 3 x 4<br><br> ordinal_y_var       A     B     C<br> 1 high             NA     1     2<br> 2 med               1     1     1<br> 3 low               2    NA    NA</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>Notice how this creates a table with different dimensions? This arrangement can quickly be undone with the accompanying <code>tidyr::gather()</code> function. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><code>tidyr::gather()</code> works a lot like the <code>tidyr::spread()</code> function, but also requires us to specify that the missing values should be removed (<code>na.rm = TRUE</code>). </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><em>I also added a <code>dplyr::select()</code> statement to arrange these values so they are similar to the table above</em>.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">DataTibble %>%<br>   dplyr::count(group_var, ordinal_y_var) %>%<br>   tidyr::spread(key = group_var, value = n) %>%<br>   tidyr::gather(key = group_var, value = "n", <br>                 -ordinal_y_var, na.rm = TRUE) %>%<br>   dplyr::select(group_var, ordinal_y_var, n)</pre>
<!-- /wp:preformatted -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>group_var</th><th>ordinal_y_var</th><th>n</th></tr></thead><tbody><tr><td>A</td><td>med</td><td>1</td></tr><tr><td>A</td><td>low</td><td>2</td></tr><tr><td>B</td><td>high</td><td>1</td></tr><tr><td>B</td><td>med</td><td>1</td></tr><tr><td>C</td><td>high</td><td>2</td></tr><tr><td>C</td><td>med</td><td>1</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:heading {"level":1} -->
<h1>Part three: Pivoting</h1>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>All this data manipulation brings us to <em>pivoting</em>, the <a href="https://tidyr.tidyverse.org/dev/articles/pivot.html">recent additions</a> to the <code>tidyr</code> package. These will be slowly replacing the functions I used above for reshaping data frames, <code>tidyr::gather()</code> and <code>tidyr::spread()</code>. I found it refreshing to learn that I wasn't the only person struggling to use these functions. Hadley Wickham, the package developer/author, confessed he also struggles when using these functions,</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><p>Many people don’t find the names intuitive and find it hard to remember which direction corresponds to spreading and which to gathering. It also seems surprisingly hard to remember the arguments to these functions, meaning that many people (including me!) have to consult the documentation every time.</p></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>Changes like these are examples of why I appreciate the <code>tidyverse</code>, because I can tell a lot of thought gets put into identifying verbs that accurately capture the users intentions. Knowing how to reshape data is an important skill for any data scientist, and the <code>tidyr::pivot_</code> functions make restructuring very clear and explicit. </p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Pivoting == fancy footwork</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Vasily Lomachenko, the best <a href="https://en.wikipedia.org/wiki/Boxing_pound_for_pound_rankings">pound-for-pound boxer</a> in the world, is known for taking [traditional Ukrainian dance classes as a child before ever stepping into a boxing ring](traditional Ukrainian dance classes). Why would an athlete who punches people for a living spend time learning how to dance? Because <strong>having the ability to quickly change angles is so essential in boxing that these skills are often what separates a good fighter from an elite athlete</strong>.</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><img src="https://github.com/mjfrigaard/storybenchR/blob/master/02.1-tidyr-tidyverse/images/loma-pivot.gif?raw=true" alt=""/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Whenever we use the <code>pivot_</code> functions, we're changing angles between the columns and rows. If the tables are pivoting from wide to longer, the column names and values rotate 90˚ into an index row. </p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><img src="https://github.com/mjfrigaard/storybenchR/blob/master/02.1-tidyr-tidyverse/images/pivot-longer-image.png?raw=true" alt=""/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Pivoting from long to wide, the index variable gets spread across the column names.</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><img src="https://github.com/mjfrigaard/storybenchR/blob/master/02.1-tidyr-tidyverse/images/pivot-wider-image.png?raw=true" alt=""/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The <code>tidyr::pivot_</code> functions give you a similar ability with your data! Being able to rapidly spin your data from columns to rows (and back) is similar to being able to rotate 90 degrees on a dime and avoid an incoming hook.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>As a skill, it's also a great place to start because most to the data you'll encounter in the <code>tidyverse</code> is going to be in columns and rows (or you will want to get them that way).</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><p>"I think footwork is one of the most important things to becoming a great fighter. That's where everything starts." - Vasyl Lomachenko</p></blockquote>
<!-- /wp:quote -->

<!-- wp:heading {"level":1} -->
<h1>Pivoting Example 1: Categorical/ordinal variable across multiple columns</h1>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>We're going to start by manipulating a data set of Lomachenko's fights from the <a href="http://boxrec.com/en/boxer/659771">BoxRec</a> database. The fight information has been entered in a way that makes sense for the person entering the data, but it's not ideal for analysis or modeling.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">LomaWideSmall %>% utils::head()</pre>
<!-- /wp:preformatted -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>opponent</th><th>date</th><th>fight_1</th><th>fight_2</th><th>fight_3</th><th>fight_4</th><th>fight_5</th><th>fight_6</th><th>fight_7</th><th>fight_8</th><th>fight_9</th><th>fight_10</th><th>fight_11</th><th>fight_12</th><th>fight_13</th><th>fight_14</th></tr></thead><tbody><tr><td>José Ramírez</td><td>2013-10-12</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr><tr><td>Orlando Salido</td><td>2014-03-01</td><td>NA</td><td>Loss</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr><tr><td>Gary Russell Jr.</td><td>2014-06-21</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr><tr><td>Chonlatarn Piriyapinyo</td><td>2014-11-22</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr><tr><td>Gamalier Rodríguez</td><td>2015-05-02</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr><tr><td>Romulo Koasicha</td><td>2015-11-07</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr><tr><td>Román Martínez</td><td>2016-06-11</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr><tr><td>Nicholas Walters</td><td>2016-11-26</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr><tr><td>Jason Sosa</td><td>2017-04-08</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr><tr><td>Miguel Marriaga</td><td>2017-08-05</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>This data arrangement is <em>Cartesian</em>, because each fight number has it's own column (<code>fight_1</code> through <code>fight_14</code>), and the result (<code>Win</code>/<code>Loss</code>) is located at the intersection between the fight numbered columns and the corresponding <code>opponent</code> and <code>date</code>. Having the data in this arrangement might seem odd to a data scientist, but this configuration makes sense for a fan entering the fights into a spreadsheet <strong>as they happen in real time</strong>. Consider the the chronological chain of events involved with a each fight, </p>
<!-- /wp:paragraph -->

<!-- wp:list {"ordered":true} -->
<ol><li>An <code>opponent</code> is announced, and an excited fan enters the information into the first two column/rows in a spreadsheet and titles it, 'Lomachenko`</li><li>The <code>date</code> for the first fight gets entered into the <code>B</code> column (the third in the table), </li><li>In order to track an athlete's win/loss record over the course of their career, a number is also marked for each fight (starting with <code>1</code>) in a column titled, <code>fight_1</code>. and the result gets put in the corresponding cell (<code>Win</code> or <code>Loss</code>)</li></ol>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>As you can see, the steps above are sensible for someone wanting to track their favorite athlete (or sports team) over time. I've encountered many excel tables with orientations that mirror the sequence of events they're capturing. This "data-entry friendly" format captures enough information to be useful, and it has a few computational abilities. For example, a fan could use filtering to count the number of matches against a particular <code>opponent</code>, or sort the <code>date</code> column to figure what Lomachenko's late fight. Spreadsheets like these are a cross between a timeline and a record book, and they do a good enough job at both tasks to justify their current structure.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The <a href="https://tidyr.tidyverse.org/dev/articles/pivot.html#wide-to-long">pivot vignette</a> conveys that 'wide' formats or data arrangements are common because their primary purpose and design is centered around recording data (and not visualization or modeling).</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Pivoting long</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>We are going to start by pivoting the <code>LomaWideSmall</code> data frame to a long or 'tidy' format. We accomplish this using the <code>tidyr::pivot_longer()</code> function. </p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">LomaWideSmall %>% <br>   tidyr::pivot_longer(<br>     cols = starts_with("fight"), <br>     names_to = "fight_no", <br>     values_to = "result", <br>     names_prefix = "fight_", <br>     na.rm = TRUE)<br><br><br>A tibble: 13 x 4<br> opponent               date       fight_no result                         <br>  1 José Ramírez           2013-10-12 1        Win   <br>  2 Orlando Salido         2014-03-01 2        Loss  <br>  3 Gary Russell Jr.       2014-06-21 3        Win   <br>  4 Chonlatarn Piriyapinyo 2014-11-22 4        Win   <br>  5 Gamalier Rodríguez     2015-05-02 5        Win   <br>  6 Romulo Koasicha        2015-11-07 6        Win   <br>  7 Román Martínez         2016-06-11 7        Win   <br>  8 Nicholas Walters       2016-11-26 8        Win   <br>  9 Jason Sosa             2017-04-08 9        Win   <br> 10 Miguel Marriaga        2017-08-05 10       Win   <br> 11 Guillermo Rigondeaux   2017-12-09 11       Win   <br> 12 Jorge Linares          2018-05-12 12       Win   <br> 13 José Pedraza           2018-12-08 13       Win</pre>
<!-- /wp:preformatted -->

<!-- wp:heading {"level":3} -->
<h3>What happens in pivot_longer()?</h3>
<!-- /wp:heading -->

<!-- wp:image -->
<figure class="wp-block-image"><img src="https://github.com/mjfrigaard/storybenchR/blob/master/02.1-tidyr-tidyverse/images/tidy-pivoting-longer.png?raw=true" alt=""/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><code>tidyr::pivot_longer()</code> extends the <code>tidyr::spread()</code> function by adding a few arguments to make this re-structuring more deliberate:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><li>The <code>cols</code> argument contains the columns we want to pivot (and it takes <a href="https://dplyr.tidyverse.org/reference/select.html"><code>tidyselect</code></a> helper functions). These are going to be the new index columns.</li><li>The <code>names_to</code> and <code>values_to</code> are the new columns we will be creating from all of the <code>fight_</code> variables. The <code>names_to</code> is the new index column, meaning how would you 'look up' the value in an adjacent column. The <code>values_to</code> are the contents of the cells that correspond to each value in the <code>names_to</code> variable. </li><li>The <code>names_prefix</code> is a regular expression pattern I can use to clean the old variable names as they become the values in the new columns. I enter <code>fight_</code> here because is will remove the text from the front the variable name and only enter the number into the new <code>fight_no</code> variable.</li></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>Unfortunately, we can see that the new <code>fight_no</code> variable is still formatted as a character. Luckily, the new <code>tidyr::pivot_longer()</code> function also has a <code>tidyr::pivot_longer_spec()</code>, which allows for additional specifications on the data transformation.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Pivoting longer (with specifications)</h2>
<!-- /wp:heading -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><p><em>A pivoting </em><code><em>spec</em></code><em> is a data frame that describes the metadata stored in the column name, with one row for each column, and one column for each variable mashed into the column name. </em></p></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>The <code>tidyr::pivot_longer_spec()</code> function allows even more specifications on what to do with the data during the transformation. Because we are still in the <code>tidyverse</code>, the output is a data fame. Explicitly creating an object that contains data about your data is not necessarily a novel concept in R, but it's very handy when that object is similar to the other objects you're already working with (i.e. a data frame or tibble).  </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Creating a <code>spec</code> for the <code>LomaWideSmall</code> data frame is a three-step process:</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4>1) Define the arguments for reshaping the data</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>I enter the same arguments I entered above in the <code>tidyr::pivot_longer()</code> function, with the exception of the <code>na.rm = TRUE</code> argument. These results get stored into an object I will name <code>LomaSpec</code>, which is a data frame with three variables in it: <code>.name</code>, <code>.value</code>, and <code>fight_no</code>.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">LomaWideSmall %>% <br>   tidyr::pivot_longer_spec(<br>      cols = starts_with("fight"), <br>      names_to = "fight_no", <br>      values_to = "result", <br>      names_prefix = "fight_")<br>LomaSpec </pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>This produces the following (if you're looking at the output in the R console).</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">A tibble: 14 x 3<br> .name    .value fight_no<br>  1 fight_1  result 1       <br>  2 fight_2  result 2       <br>  3 fight_3  result 3       <br>  4 fight_4  result 4       <br>  5 fight_5  result 5       <br>  6 fight_6  result 6       <br>  7 fight_7  result 7       <br>  8 fight_8  result 8       <br>  9 fight_9  result 9       <br> 10 fight_10 result 10      <br> 11 fight_11 result 11      <br> 12 fight_12 result 12      <br> 13 fight_13 result 13      <br> 14 fight_14 result 14      </pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>The three columns in <code>LomaSpec</code> contain metadata (data about our data) on the transformation I want to perform--specifically the original columns (<code>.name</code>) and the corresponding cell values (<code>.value</code>). The other variable (<code>fight_no</code>) gets carried over from the transformation as well. </p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4>2) Format the variable(s) in the spec</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>If I want to format the <code>fight_no</code> variable, I can include those arguments <em>within</em> the <code>LomaSpec</code> data frame.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted"># format the variable<br> LomaSpec &lt;- LomaSpec %>%<br> dplyr::mutate(fight_no = as.numeric(fight_no))<br> LomaSpec$fight_no %>% glimpse(78)<br># num [1:14] 1 2 3 4 5 6 7 8 9 10 ...</pre>
<!-- /wp:preformatted -->

<!-- wp:heading {"level":4} -->
<h4>3) Supply the formatted spec object to pivot_longer_spec() function</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Now <code>LomaSpec</code> can get supplied to the <code>tidyr::pivot_longer()</code> function and the <code>fight_no</code> variable is properly formatted (note I still need to provide the <code>na.rm = TRUE</code> argument).</p>
<!-- /wp:paragraph -->

<!-- wp:html -->
<pre># supply it to the pivot_longer
LomaFightsLong <- LomaWideSmall %>% 
    tidyr::pivot_longer(spec = LomaSpec, 
                        na.rm = TRUE) 
LomaFightsLong
</pre>
<!-- /wp:html -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>opponent</th><th>date</th><th>fight_no</th><th>result</th></tr></thead><tbody><tr><td>José Ramírez</td><td>2013-10-12</td><td>1</td><td>Win</td></tr><tr><td>Orlando Salido</td><td>2014-03-01</td><td>2</td><td>Loss</td></tr><tr><td>Gary Russell Jr.</td><td>2014-06-21</td><td>3</td><td>Win</td></tr><tr><td>Chonlatarn Piriyapinyo</td><td>2014-11-22</td><td>4</td><td>Win</td></tr><tr><td>Gamalier Rodríguez</td><td>2015-05-02</td><td>5</td><td>Win</td></tr><tr><td>Romulo Koasicha</td><td>2015-11-07</td><td>6</td><td>Win</td></tr><tr><td>Román Martínez</td><td>2016-06-11</td><td>7</td><td>Win</td></tr><tr><td>Nicholas Walters</td><td>2016-11-26</td><td>8</td><td>Win</td></tr><tr><td>Jason Sosa</td><td>2017-04-08</td><td>9</td><td>Win</td></tr><tr><td>Miguel Marriaga</td><td>2017-08-05</td><td>10</td><td>Win</td></tr><tr><td>Guillermo Rigondeaux</td><td>2017-12-09</td><td>11</td><td>Win</td></tr><tr><td>Jorge Linares</td><td>2018-05-12</td><td>12</td><td>Win</td></tr><tr><td>José Pedraza</td><td>2018-12-08</td><td>13</td><td>Win</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>These data are now in a tidy (indexed) format. </p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Pivoting wider</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>No one wins a boxing match by only avoiding punches--eventually they have to hit someone (and probably more than once). Another reason that being able to change angles quickly is advantageous is that it creates more opportunities to throw (and land) punches. As you can see below, Lomachenko's pivoting abilities not only make him frustratingly hard to hit, but they also allow him to see openings in his opponents defenses (which makes him incredibly successful at landing punches).  </p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><img src="https://github.com/mjfrigaard/storybenchR/blob/master/02.1-tidyr-tidyverse/images/loma-pivot-strike.gif?raw=true" alt=""/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":1} -->
<h1>Pivoting Example 2: Moving categorical or ordinal variables across columns</h1>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>It's less common, but sometimes you'll need to move variables from an indexed (or tidy) column arrangement into a Cartesian (wide) format. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In order to restructure a Cartesian data frame to an indexed data frame (or to go from "long" to "wide"), we need to use the <code>tidyr::pivot_wider()</code> function. This works much like the <code>pivot_longer()</code> function, but with a few different arguments. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Consider a data frame with the same Lomachenko fight records, but this time arranged by date. Imagine the following events that would lead to the creation of the <code>LomaDatesWide</code> data:</p>
<!-- /wp:paragraph -->

<!-- wp:list {"ordered":true} -->
<ol><li>It's announced that Lomachenko will be fighting an <code>opponent</code> and <code>location</code> is announced, and our fan enters the information into the first two column/rows in her 'Lomachenko` spreadsheet </li><li>A <code>fight_number</code> column is created to document the number of fights (as they happen)</li><li>The date for the first fight (<code>12 Oct 2013</code>) gets entered into the the fourth column in the table, and the result (<code>Win</code>) gets put in the corresponding cell</li><li>After the scorecards are collected, the <code>result</code> is announced (see key below), the <code>fight_record</code> is updated (with the official outcome of the bout)</li><li>The official round and time (<code>round_time</code>) is recorded for when the fight had to stop (or the total number of rounds if it went the distance), </li><li>Titles and belts are listed in the <code>notes</code> section</li><li>When the next fight happens, our fan right-clicks on the last recorded fight, and inserts a new column and date, and repeats steps 1-6</li></ol>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p><em>I tend to find tables like these when the data entry is done using 'Freeze Columns' or 'Freeze Rows'.</em></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><img src="https://github.com/mjfrigaard/storybenchR/blob/master/02.1-tidyr-tidyverse/images/freeze-cells.gif?raw=true" alt=""/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The <code>LomaFights</code> data frame has the fight records for Lomachenko from his <a href="https://en.wikipedia.org/wiki/Vasyl_Lomachenko">wikipedia table</a>. To create a spreadsheet like the one above, we can use the <code>tidyr::pivot_wider()</code> function. </p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>I add a few <code>dplyr</code> functions to get the data frame to look identical to the excel file above. </p>
<!-- /wp:paragraph -->

<!-- wp:html -->
<pre>
LomaFights %>% 
    # the columns come from the dates
    tidyr::pivot_wider(names_from = date, 
                       # the values will be the result of the fight
                       values_from = result) %>% 
    # arrange by the fight number 
    dplyr::arrange(no) %>% 
    # rearrange the columns
    dplyr::select(opponent, location,
                  dplyr::starts_with("20"),
                  dplyr::everything())
</pre>
<!-- /wp:html -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>opponent</th><th>location</th><th>2013-10-12</th><th>2014-03-01</th><th>2014-06-21</th><th>2014-11-22</th><th>2015-05-02</th><th>2015-11-07</th><th>2016-06-11</th><th>2016-11-26</th><th>2017-04-08</th><th>2017-08-05</th><th>2017-12-09</th><th>2018-05-12</th><th>2018-12-08</th><th>2019-04-12</th><th>no</th><th>record</th><th>type</th><th>rounds</th><th>time</th><th>notes</th></tr></thead><tbody><tr><td>José Ramírez</td><td>Thomas &amp; Mack Center, Paradise, Nevada, US</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>1</td><td>1–0</td><td>TKO</td><td>4 (10)</td><td>2:55</td><td>Won WBO International featherweight title</td></tr><tr><td>Orlando Salido</td><td>Alamodome, San Antonio, Texas, US</td><td>NA</td><td>Loss</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>2</td><td>1–1</td><td>SD</td><td>12</td><td>NA</td><td>For vacant WBO featherweight title</td></tr><tr><td>Gary Russell Jr.</td><td>StubHub Center, Carson, California, US</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>3</td><td>2–1</td><td>MD</td><td>12</td><td>NA</td><td>Won vacant WBO featherweight title</td></tr><tr><td>Chonlatarn Piriyapinyo</td><td>Cotai Arena, Macau, SAR</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>4</td><td>3–1</td><td>UD</td><td>12</td><td>NA</td><td>Retained WBO featherweight title</td></tr><tr><td>Gamalier Rodríguez</td><td>MGM Grand Garden Arena, Paradise, Nevada, US</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>5</td><td>4–1</td><td>KO</td><td>9 (12)</td><td>0:50</td><td>Retained WBO featherweight title</td></tr><tr><td>Romulo Koasicha</td><td>Thomas &amp; Mack Center, Paradise, Nevada, US</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>6</td><td>5–1</td><td>KO</td><td>10 (12)</td><td>2:35</td><td>Retained WBO featherweight title</td></tr><tr><td>Román Martínez</td><td>The Theater at Madison Square Garden, New York City, New York, US</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>7</td><td>6–1</td><td>KO</td><td>5 (12)</td><td>1:09</td><td>Won WBO junior lightweight title</td></tr><tr><td>Nicholas Walters</td><td>Cosmopolitan of Las Vegas, Paradise, Nevada, US</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>8</td><td>7–1</td><td>RTD</td><td>7 (12)</td><td>3:00</td><td>Retained WBO junior lightweight title</td></tr><tr><td>Jason Sosa</td><td>MGM National Harbor, Oxon Hill, Maryland, US</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>9</td><td>8–1</td><td>RTD</td><td>9 (12)</td><td>3:00</td><td>Retained WBO junior lightweight title</td></tr><tr><td>Miguel Marriaga</td><td>Microsoft Theater, Los Angeles, California, US</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>10</td><td>9–1</td><td>RTD</td><td>7 (12)</td><td>3:00</td><td>Retained WBO junior lightweight title</td></tr><tr><td>Guillermo Rigondeaux</td><td>The Theater at Madison Square Garden, New York City, New York, US</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>NA</td><td>11</td><td>10–1</td><td>RTD</td><td>6 (12)</td><td>3:00</td><td>Retained WBO junior lightweight title</td></tr><tr><td>Jorge Linares</td><td>Madison Square Garden, New York City, New York, US</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>NA</td><td>12</td><td>11–1</td><td>TKO</td><td>10 (12)</td><td>2:08</td><td>Won WBA (Super) and The Ring lightweight titles</td></tr><tr><td>José Pedraza</td><td>Hulu Theater, New York City, New York, US</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Win</td><td>NA</td><td>13</td><td>12–1</td><td>UD</td><td>12</td><td>NA</td><td>Retained WBA (Super) and The Ring lightweight titles;Won WBO lightweight title</td></tr><tr><td>Anthony Crolla</td><td>Staples Center, Los Angeles, California, US</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>14</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>Defending WBA (Super), WBO, and The Ring lightweight titles</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:heading -->
<h2>Pivoting wider options</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>The output is <em>very</em> close to identical to the excel sheet above, except missing values in excel are empty (not an <code>NA</code> like R). I can use the <code>tidyr::pivot_wider(x, values_fill())</code> to include this change to the data.</p>
<!-- /wp:paragraph -->

<!-- wp:html -->
<pre>
LomaFights %>% <br>
    tidyr::pivot_wider(names_from = date, <br>
                       values_from = result,<br>
                       values_fill = list(result = "")) %>% <br>
    dplyr::arrange(no) %>% <br>
    dplyr::select(opponent, <br>
                  location,<br>
                  dplyr::starts_with("20"),<br>
                  dplyr::everything())

# A tibble: 14 x 16
   opponent   location      `2013-10-12` `2014-03-01` `2014-06-21` `2014-11-22` `2015-05-02` `2015-11-07` `2016-06-11` `2016-11-26` `2017-04-08` `2017-08-05` `2017-12-09` `2018-05-12` `2018-12-08` `2019-04-12`
   <chr>      <chr>         <chr>        <chr>        <chr>        <chr>        <chr>        <chr>        <chr>        <chr>        <chr>        <chr>        <chr>        <chr>        <chr>        <chr>       
 1 José Ramí… Thomas & Mac… Win          ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""          
 2 Orlando S… Alamodome, S… ""           Loss         ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""          
 3 Gary Russ… StubHub Cent… ""           ""           Win          ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""          
 4 Chonlatar… Cotai Arena,… ""           ""           ""           Win          ""           ""           ""           ""           ""           ""           ""           ""           ""           ""          
 5 Gamalier … MGM Grand Ga… ""           ""           ""           ""           Win          ""           ""           ""           ""           ""           ""           ""           ""           ""          
 6 Romulo Ko… Thomas & Mac… ""           ""           ""           ""           ""           Win          ""           ""           ""           ""           ""           ""           ""           ""          
 7 Román Mar… The Theater … ""           ""           ""           ""           ""           ""           Win          ""           ""           ""           ""           ""           ""           ""          
 8 Nicholas … Cosmopolitan… ""           ""           ""           ""           ""           ""           ""           Win          ""           ""           ""           ""           ""           ""          
 9 Jason Sosa MGM National… ""           ""           ""           ""           ""           ""           ""           ""           Win          ""           ""           ""           ""           ""          
10 Miguel Ma… Microsoft Th… ""           ""           ""           ""           ""           ""           ""           ""           ""           Win          ""           ""           ""           ""          
11 Guillermo… The Theater … ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           Win          ""           ""           ""          
12 Jorge Lin… Madison Squa… ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           Win          ""           ""          
13 José Pedr… Hulu Theater… ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           Win          ""          
14 Anthony C… Staples Cent… ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           ""           NA   
</pre>
<!-- /wp:html -->

<!-- wp:paragraph -->
<p>Another neat part of the <code>pivot_wider()</code> function is the <code>values_from</code> argument can take multiple columns. For example, if I wanted to see how man <code>Win</code>s resulted in <code>TKO</code>s (technical knock-outs) or <code>KO</code>s (knock-outs) and their corresponding rounds and time, I could use the following to see <code>rounds</code> and <code>time</code> in separate columns.</p>
<!-- /wp:paragraph -->

<!-- wp:html -->
<pre>LomaFights %>% <br>
    dplyr::filter(result == "Win") %>% <br>
    pivot_wider(names_from = c(type),<br>
                values_from = c(rounds, time),<br>
                values_fill = list(rounds = "",<br>
                                   time = "")) %>% <br>
    dplyr::select(opponent,<br>
                  dplyr::contains("_KO"),<br>
                  dplyr::contains("_TKO"))<br>
</pre>
<!-- /wp:html -->

<!-- wp:html -->
<pre>
# A tibble: 12 x 5
   opponent               rounds_KO time_KO rounds_TKO time_TKO
   <chr>                  <chr>     <chr>   <chr>      <chr>   
 1 José Ramírez           ""        ""      4 (10)     2:55    
 2 Gary Russell Jr.       ""        ""      ""         ""      
 3 Chonlatarn Piriyapinyo ""        ""      ""         ""      
 4 Gamalier Rodríguez     9 (12)    0:50    ""         ""      
 5 Romulo Koasicha        10 (12)   2:35    ""         ""      
 6 Román Martínez         5 (12)    1:09    ""         ""      
 7 Nicholas Walters       ""        ""      ""         ""      
 8 Jason Sosa             ""        ""      ""         ""      
 9 Miguel Marriaga        ""        ""      ""         ""      
10 Guillermo Rigondeaux   ""        ""      ""         ""      
11 Jorge Linares          ""        ""      10 (12)    2:08    
12 José Pedraza           ""        ""      ""         ""   
</pre>
<!-- /wp:html -->

<!-- wp:paragraph -->
<p>We can also use the <code>tidyr::pivot_wider()</code> function like <code>tidyr::spread()</code> function above. If I want to see the fight <code>results</code> by type, but with <code>Win</code> and <code>Loss</code> in separate columns, I can use the following sequence. </p>
<!-- /wp:paragraph -->

<!-- wp:html -->
<pre>
LomaFights %>% <br>
    dplyr::filter(!is.na(result)) %>% <br>
    dplyr::count(type, result) %>% <br>
    tidyr::pivot_wider(<br>
            names_from = result, <br>
            values_from = n,<br>
            values_fill = list(n = 0))
</pre>
<!-- /wp:html -->

<!-- wp:table -->
<table class="wp-block-table"><thead><tr><th>type</th><th>Win</th><th>Loss</th></tr></thead><tbody><tr><td>KO</td><td>3</td><td>0</td></tr><tr><td>MD</td><td>1</td><td>0</td></tr><tr><td>RTD</td><td>4</td><td>0</td></tr><tr><td>SD</td><td>0</td><td>1</td></tr><tr><td>TKO</td><td>2</td><td>0</td></tr><tr><td>UD</td><td>2</td><td>0</td></tr></tbody></table>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>As yAs you can see, these new <code>tidyr::pivot_</code> functions extend <code>tidyr::gather()</code> and <code>tidyr::spread()</code> with more options and flexibility. It might take a little getting used to at first, but I think you'll find these are a welcome addition to all of the data manipulation in the <code>tidyverse</code>.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Read more</h2>
<!-- /wp:heading -->

<!-- wp:list -->
<ul><li>Check out the <a href="https://tidyr.tidyverse.org/dev/articles/pivot.html">pivoting vignette</a> on the tidyverse website. </li><li>Alison Presmanes Hill has some great examples in this <a href="https://github.com/apreshill/teachthat/tree/master/pivot">Github repo</a>.</li><li>Read the <a href="https://github.com/tidyverse/tidyr/blob/master/NEWS.md"><code>NEWS.md</code> file</a> on the <code>tidyr</code> github page for new changes to these functions (and others!) </li><li>Be sure to check out <a href="https://es.pn/2CUzPFl">Vasiliy Lomachenko when he fights Anthony Crolla</a> on April 12!</li></ul>
<!-- /wp:list -->