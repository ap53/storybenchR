---
title: "Data Science Communication using R - tidyr"
author: "Martin Frigaard"
date: "2017-05-12"
output: 
  github_document: 
    df_print: kable
    toc: yes
    toc_depth: 5
---

```{r setup, include=FALSE}
library(tidyverse)
library(magrittr)
if (!file.exists("images/")) {
  dir.create("images/")
}
knitr::opts_chunk$set(
  echo = TRUE, # show all code
  tidy = FALSE, # cleaner code printing
  eval = FALSE,
  size = "small",
  fig.path = "images/"
) # smaller code
opts_knit$set(width = 75)
options(max.print = "75")
```

*TLDR: This tutorial was prompted by the recent changes to the `tidyr` package (see the tweet from Hadley Wickham below). Two functions for reshaping columns and rows (`gather()` and `spread()`) were replaced with `tidyr::pivot_longer()` and `tidyr::pivot_wider()` functions.*

> Thanks to all 2649 (!!!) people who completed my survey about table shapes! I&#39;ve done analysed the data at <a href="https://t.co/hyu1o91xRm">https://t.co/hyu1o91xRm</a> and the new functions will be called pivot_longer() and pivot_wider() <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a></p>&mdash; Hadley Wickham (@hadleywickham) <a href="https://twitter.com/hadleywickham/status/1109816130774986753?ref_src=twsrc%5Etfw">March 24, 2019</a>
> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

```{r packages, eval=TRUE}
# this will require the newest version of tidyr from github
# devtools::install_github("tidyverse/tidyr")
library(tidyverse)
```

# Objectives

This tutorial will introduce three underlying concepts about working with data in the `tidyverse`: 1) tidy data, 2) grouping, and 3) pivoting. A solid understanding of these concepts will make it easier to use the other packages in the `tidyverse` to manipulate and re-structure your data for visualizations and modeling. 

I'll be using examples of spreadsheets designed for data entry, not statistical modeling or graphics. My goal is that by showing the reasoning/purpose for each data entry process, you'll walk away with a better understanding (and hopefully a little less frustration) for why data are collected a certain way. 


***

# Tidy data 

“Tidy data” is a term that describes a standardized approach to structuring datasets to make analyses and visualizations easier in R. If you’ve worked with SQL and relational databases, you’ll recognize most of these concepts. Hadley Wickham distilled a lot of the technical jargon from [Edgar F. Codd’s 'normal form'](https://en.wikipedia.org/wiki/Third_normal_form) and applied it to statistical terms. More importantly, he translated these essential principles into concepts and terms a broader audience can grasp and use for data manipulation. Tidy data is a...

> "*...standardized way to link the structure of a dataset (its physical layout) with its semantics (its meaning)*"

## Core tidy data principles

Tidy data, at least in the `tidyverse`, is referring to 'rectangular' data. These are the data we typically see in spreadsheet software like Googlesheets, Microsoft Excel, or in a relational database like MySQL or Microsoft Access, The three principles for tidy rectangular data are:

1. Variables make up columns 
2. Observations (or cases) go in the rows 
3. Values are in cells 
 
While these might seem obvious at first, many of the problematic data arrangements you’ll encounter come from not adhering to their guidance. Bear with me as I walk through why if the two first statements are true, the third becomes all but guaranteed (see image below).

```{r table-intersection.png, echo=FALSE, eval=TRUE}
# fs::dir_ls("images")
knitr::include_graphics(path = "images/table-intersection.png")
```

Not all data you'll encounter are arranged in a tidy way, but I think transforming and thinking of your data into this format is a helpful way to understand data manipulation in the `tidyverse`.

***

# Scenario 1: cholesterol medication trial

Assume a physician wants to compare the efficacy of a new statin drug against the currently recommended anti-hypercholesterolemia medication. After consenting 20 patients with high cholesterol, the physician gives 10 of the patients the new drug for two-weeks. The other 10 patients get a two-week course of the current drug. 

```{r TrialData, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
base::source("data/trial-data.R")
TrialData %>% dplyr::count(group)
```


 table can contain any number of fields, which are used to store the various attributes associated with each record.

Suppose that , A and B, say. (the important question of how to choose which 10 patients should be given drug A will be discussed in Chapter 5). Two weeks later, the clinician measures the (systolic) blood pressure of all 20 patients and obtains the following results:








